:NewParser

// More specific checks from parser folder

code"[]"
//│ res: Code[(), anything]
//│    = [ 'Bra', [ 'Tup', [] ] ]
run(res)
//│ res: ()
//│    = []

code"()"
run(res)
//│ res: Code[(), anything]
//│    = [ 'Bra', [ 'Tup', [] ] ]
//│ res: ()
//│    = []

code"(1,)"
run(res)
//│ res: Code[(1,), anything]
//│    = [ 'Bra', [ 'Tup', [ [Array] ] ] ]
//│ res: (1,)
//│    = [ 1 ]

code"let f = (x, y, z) => x + y + x; f of 1,2,3"
run(res)
//│ res: Code[int, anything]
//│    = [
//│        'Let',
//│        'f',
//│        Symbol(f),
//│        [
//│          'Lam',
//│          [ [Array], [Array], [Array] ],
//│          [ 'App', '+', [Array], [Array] ]
//│        ],
//│        [ 'App_Fun', [ 'Var', Symbol(f) ], [ 'Tup', [Array] ] ]
//│      ]
//│ res: int
//│    = 4

//any of a, b, c -> codegen error from unresolved symbol "any"

:pe
code"// Can I comment?"
//│ ╔══[PARSE ERROR] Unmatched opening quasiquote
//│ ║  l.46: 	code"// Can I comment?"
//│ ╙──      	^^^^^

code"[x: 1,]"
//│ res: Code[(x: 1,), anything]
//│    = [ 'Bra', [ 'Tup', [ [Array] ] ] ]
run(res)
//│ res: (x: 1,)
//│    = [ 1 ]

// should be unresolved symbol error 
code"let x = {a: 100}; x . a"
//│ res: Code['a, {.: {a: 100} -> 'b -> 'a, a: 'b}]
//│    = [
//│        'Let',
//│        'x',
//│        Symbol(x),
//│        [ 'Bra', [ 'Rcd', [Object] ] ],
//│        [ 'App_Fun', [ 'App_Fun', [Array], [Array] ], [ 'Tup', [Array] ] ]
//│      ]

:re
:e
run(res)
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.71: 	run(res)
//│ ║        	^^^^^^^^
//│ ╙── type `anything` is not a record (expected a record with fields: a, .)
//│ res: error
//│ Runtime error:
//│   TypeError: globalThis[callee] is not a function

// should be unresolved symbol error
code"let x = {a: 100}; x. a"
//│ res: Code['a, {.: {a: 100} -> 'b -> 'a, a: 'b}]
//│    = [
//│        'Let',
//│        'x',
//│        Symbol(x),
//│        [ 'Bra', [ 'Rcd', [Object] ] ],
//│        [ 'App_Fun', [ 'App_Fun', [Array], [Array] ], [ 'Tup', [Array] ] ]
//│      ]
:re
:e
run(res)
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.92: 	run(res)
//│ ║        	^^^^^^^^
//│ ╙── type `anything` is not a record (expected a record with fields: a, .)
//│ res: error
//│ Runtime error:
//│   TypeError: globalThis[callee] is not a function

// should be ok
code"let x = {a: 100}; x .a"
//│ res: Code[100, anything]
//│    = [
//│        'Let',
//│        'x',
//│        Symbol(x),
//│        [ 'Bra', [ 'Rcd', [Object] ] ],
//│        [ 'Sel', [ 'Var', Symbol(x) ], 'a' ]
//│      ]

run(res)
//│ res: 100
//│    = 100
