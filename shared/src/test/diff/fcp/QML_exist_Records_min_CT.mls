// * This is a minimization of the error that happens in `QML_exist_Records`


:NoRecursiveTypes
:GeneralizeCurriedFunctions
:ConstrainedTypes
// :DistributeForalls
// :ArgGen


type ArraysRep[Rep] = { fold: forall 'b. 'b -> Rep -> 'b }
//│ Defined type alias ArraysRep[-Rep]

type Arrays = (forall 'Rep. ArraysRep['Rep] -> 'r) -> 'r
//│ Defined type alias Arrays

// :d
def stepImpl arrImpl = { fold = fun f -> fun r0 -> arrImpl.fold f r0 }
//│ stepImpl: 'a -> {fold: forall 'b. 'b -> (forall 'c, 'd, 'fold, 'a, 'b, 'e. ('e -> 'c
//│   where
//│     'a <: {fold: 'b -> ('e -> 'c & 'd) & 'fold}))}
//│         = [Function: stepImpl]

// :d
def stepImpl2 arr = arr stepImpl
//│ stepImpl2: ((forall 'a. 'a -> {fold: forall 'b. 'b -> (forall 'b, 'c, 'd, 'e, 'a, 'fold. ('e -> 'd
//│   where
//│     'a <: {fold: 'b -> ('e -> 'd & 'c) & 'fold}))}) -> 'f & 'g) -> 'f
//│          = [Function: stepImpl2]

def step: Arrays -> Arrays
//│ step: Arrays -> Arrays
//│     = <missing implementation>

:e // * Since "sound extrusion"
def step arr g = g (stepImpl2 arr)
//│ 'a -> (forall 'b, 'a, 'c, 'd, 'e. (('d -> 'e & 'b) -> 'e
//│   where
//│     'a <: (forall 'f. 'f -> {fold: forall 'g. 'g -> (forall 'f, 'h, 'i, 'j, 'fold, 'g. ('j -> 'i
//│   where
//│     'f <: {fold: 'g -> ('j -> 'i & 'h) & 'fold}))}) -> ('c & 'd)))
//│   <:  step:
//│ Arrays -> Arrays
//│ ╔══[ERROR] Type mismatch in def definition:
//│ ║  l.36: 	def step arr g = g (stepImpl2 arr)
//│ ║        	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ╟── type `anything` does not match type `nothing`
//│ ║  l.11: 	type ArraysRep[Rep] = { fold: forall 'b. 'b -> Rep -> 'b }
//│ ║        	                                     ^^
//│ ╟── Note: constraint arises from quantified type variable:
//│ ║  l.11: 	type ArraysRep[Rep] = { fold: forall 'b. 'b -> Rep -> 'b }
//│ ║        	                                     ^^
//│ ╟── from application:
//│ ║  l.18: 	def stepImpl arrImpl = { fold = fun f -> fun r0 -> arrImpl.fold f r0 }
//│ ╙──      	                                                   ^^^^^^^^^^^^^^^^^
//│     = [Function: step]

