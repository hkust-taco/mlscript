:NewDefs
:NoJS // TODO



mixin Test {
  class Foo(n: int)
  let f = Foo(123)
}
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.8: 	  let f = Foo(123)
//│ ║       	          ^^^^^^^^
//│ ╟── integer literal of type `123` is not an instance of type `int`
//│ ║  l.8: 	  let f = Foo(123)
//│ ║       	              ^^^
//│ ╟── Note: constraint arises from type reference:
//│ ║  l.7: 	  class Foo(n: int)
//│ ╙──     	               ^^^
//│ mixin Test() {
//│   class Foo(n: int)
//│   let f: Foo | error
//│ }

module M extends Test
//│ module M() {
//│   class Foo(n: int)
//│   let f: Foo | error
//│ }

M.f
//│ Foo | error

M.f.n
//│ error | int

:e
M.Foo
//│ ╔══[ERROR] access to class member not yet supported
//│ ║  l.37: 	M.Foo
//│ ╙──      	 ^^^^
//│ error

:e // TODO support
fun foo(x) = if x is M.Foo then 1
//│ ╔══[ERROR] illegal pattern
//│ ║  l.44: 	fun foo(x) = if x is M.Foo then 1
//│ ╙──      	                     ^^^^^
//│ fun foo: anything -> error

:e
mixin Test2 { let f = Foo(1) }
//│ ╔══[ERROR] identifier not found: Foo
//│ ║  l.51: 	mixin Test2 { let f = Foo(1) }
//│ ╙──      	                      ^^^
//│ mixin Test2() {
//│   let f: error
//│ }

:e
mixin Test3 { fun f(x) = if x is Foo then 1 }
//│ ╔══[ERROR] Cannot find constructor `Foo` in scope
//│ ║  l.60: 	mixin Test3 { fun f(x) = if x is Foo then 1 }
//│ ╙──      	                                 ^^^
//│ mixin Test3() {
//│   fun f: anything -> error
//│ }



:e // TODO support
mixin Test {
  class Lit(n: int)
  class Add<A>(lhs: A, rhs: A) {
    let cached = size(this)
  }
  fun size(x) = if x is
    Add(l, r) then this.size(l) + this.size(r)
}
//│ ╔══[ERROR] Unhandled cyclic definition
//│ ║  l.73: 	  class Add<A>(lhs: A, rhs: A) {
//│ ║        	  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.74: 	    let cached = size(this)
//│ ║        	^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.75: 	  }
//│ ╙──      	^^^
//│ ╔══[ERROR] Illegal pattern `Add`
//│ ║  l.77: 	    Add(l, r) then this.size(l) + this.size(r)
//│ ╙──      	    ^^^
//│ mixin Test() {
//│   class Add[A](lhs: A, rhs: A) {
//│     let cached: error
//│   }
//│   class Lit(n: int)
//│   fun size: anything -> error
//│ }


