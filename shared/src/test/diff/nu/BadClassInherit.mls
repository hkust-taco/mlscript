:NewDefs


class C1(x: Int)
//│ class C1(x: Int)

:e
class C2(x: Int) extends C1(y) {
  val y = x
}
//│ ╔══[ERROR] identifier not found: y
//│ ║  l.8: 	class C2(x: Int) extends C1(y) {
//│ ╙──     	                            ^
//│ ╔══[ERROR] Inherited parameter named `x` is not virtual and cannot be overridden
//│ ║  l.8: 	class C2(x: Int) extends C1(y) {
//│ ║       	         ^
//│ ╟── Originally declared here:
//│ ║  l.4: 	class C1(x: Int)
//│ ╙──     	         ^
//│ class C2(x: Int) extends C1 {
//│   val y: Int
//│ }
//│ Code generation encountered an error:
//│   unresolved symbol y

:e
abstract class C2 extends C1(y) {
  val y: Int
}
//│ ╔══[ERROR] identifier not found: y
//│ ║  l.27: 	abstract class C2 extends C1(y) {
//│ ╙──      	                             ^
//│ abstract class C2 extends C1 {
//│   val y: Int
//│ }
//│ Code generation encountered an error:
//│   unresolved symbol y

:e
abstract class C2 extends C1(this.y) {
  val y: Int
}
//│ ╔══[ERROR] identifier not found: this
//│ ║  l.40: 	abstract class C2 extends C1(this.y) {
//│ ╙──      	                             ^^^^
//│ abstract class C2 extends C1 {
//│   val y: Int
//│ }


class C1(x: C1)
//│ class C1(x: C1)

:e
class C2 extends C1(this)
//│ ╔══[ERROR] identifier not found: this
//│ ║  l.55: 	class C2 extends C1(this)
//│ ╙──      	                    ^^^^
//│ class C2 extends C1 {
//│   constructor()
//│ }


class Foo { virtual fun x: Int = 1 }
//│ class Foo {
//│   constructor()
//│   fun x: Int
//│ }

:e
class Bar extends Foo { fun x = false }
//│ ╔══[ERROR] Type mismatch in definition of method x:
//│ ║  l.71: 	class Bar extends Foo { fun x = false }
//│ ║        	                            ^^^^^^^^^
//│ ╟── reference of type `false` is not an instance of type `Int`
//│ ║  l.71: 	class Bar extends Foo { fun x = false }
//│ ║        	                                ^^^^^
//│ ╟── but it flows into definition of method x with expected type `Int`
//│ ║  l.71: 	class Bar extends Foo { fun x = false }
//│ ║        	                            ^^^^^^^^^
//│ ╟── Note: constraint arises from type reference:
//│ ║  l.64: 	class Foo { virtual fun x: Int = 1 }
//│ ║        	                           ^^^
//│ ╟── from definition of method x:
//│ ║  l.64: 	class Foo { virtual fun x: Int = 1 }
//│ ╙──      	                        ^^^^^^^^^^
//│ class Bar extends Foo {
//│   constructor()
//│   fun x: false
//│ }

:e
class Bar extends Foo {
  fun x: Bool
  fun x = false
}
//│ ╔══[ERROR] Type mismatch in signature of member `x`:
//│ ║  l.94: 	  fun x: Bool
//│ ║        	      ^^^^^^^
//│ ╟── type `Bool` is not an instance of type `Int`
//│ ║  l.94: 	  fun x: Bool
//│ ║        	         ^^^^
//│ ╟── but it flows into signature of member `x` with expected type `Int`
//│ ║  l.94: 	  fun x: Bool
//│ ║        	      ^^^^^^^
//│ ╟── Note: constraint arises from type reference:
//│ ║  l.64: 	class Foo { virtual fun x: Int = 1 }
//│ ║        	                           ^^^
//│ ╟── from definition of method x:
//│ ║  l.64: 	class Foo { virtual fun x: Int = 1 }
//│ ╙──      	                        ^^^^^^^^^^
//│ ╔══[ERROR] Type mismatch in signature of member `x`:
//│ ║  l.94: 	  fun x: Bool
//│ ║        	      ^^^^^^^
//│ ╟── type `Bool` is not an instance of type `Int`
//│ ║  l.94: 	  fun x: Bool
//│ ║        	         ^^^^
//│ ╟── but it flows into signature of member `x` with expected type `Int`
//│ ║  l.94: 	  fun x: Bool
//│ ║        	      ^^^^^^^
//│ ╟── Note: constraint arises from type reference:
//│ ║  l.64: 	class Foo { virtual fun x: Int = 1 }
//│ ║        	                           ^^^
//│ ╟── from definition of method x:
//│ ║  l.64: 	class Foo { virtual fun x: Int = 1 }
//│ ╙──      	                        ^^^^^^^^^^
//│ class Bar extends Foo {
//│   constructor()
//│   fun x: Bool
//│ }

mixin M { fun x = false }
//│ mixin M() {
//│   fun x: false
//│ }

:e
class Bar extends Foo, M
//│ ╔══[ERROR] Type mismatch in definition of method x:
//│ ║  l.132: 	mixin M { fun x = false }
//│ ║         	              ^^^^^^^^^
//│ ╟── reference of type `false` is not an instance of type `Int`
//│ ║  l.132: 	mixin M { fun x = false }
//│ ║         	                  ^^^^^
//│ ╟── but it flows into definition of method x with expected type `Int`
//│ ║  l.132: 	mixin M { fun x = false }
//│ ║         	              ^^^^^^^^^
//│ ╟── Note: constraint arises from type reference:
//│ ║  l.64: 	class Foo { virtual fun x: Int = 1 }
//│ ║        	                           ^^^
//│ ╟── from definition of method x:
//│ ║  l.64: 	class Foo { virtual fun x: Int = 1 }
//│ ╙──      	                        ^^^^^^^^^^
//│ class Bar extends Foo {
//│   constructor()
//│   fun x: false
//│ }



class A { class X { fun f = 1 } }
trait B { class X { fun g = 1 } }
//│ class A {
//│   constructor()
//│   class X {
//│     constructor()
//│     fun f: 1
//│   }
//│ }
//│ trait B {
//│   class X {
//│     constructor()
//│     fun g: 1
//│   }
//│ }

:e
class C extends A, B
//│ ╔══[ERROR] Class member `X` cannot override class member of the same name declared in parent
//│ ║  l.178: 	class C extends A, B
//│ ║         	^^^^^^^^^^^^^^^^^^^^
//│ ╟── Originally declared here:
//│ ║  l.162: 	trait B { class X { fun g = 1 } }
//│ ╙──       	          ^^^^^^^^^^^^^^^^^^^^^
//│ ╔══[ERROR] Intersection of class member and class members currently unsupported
//│ ║  l.178: 	class C extends A, B
//│ ║         	^^^^^^^^^^^^^^^^^^^^
//│ ╟── The class member is defined here:
//│ ║  l.161: 	class A { class X { fun f = 1 } }
//│ ║         	          ^^^^^^^^^^^^^^^^^^^^^
//│ ╟── The class member is defined here:
//│ ║  l.162: 	trait B { class X { fun g = 1 } }
//│ ╙──       	          ^^^^^^^^^^^^^^^^^^^^^
//│ class C extends A, B {
//│   constructor()
//│   class X {
//│     constructor()
//│     fun f: 1
//│   }
//│ }

:e
class C extends A {
  class X { fun g = 1 }
}
//│ ╔══[ERROR] Class member `X` cannot override class member of the same name declared in parent
//│ ║  l.203: 	class C extends A {
//│ ║         	^^^^^^^^^^^^^^^^^^^
//│ ║  l.204: 	  class X { fun g = 1 }
//│ ║         	^^^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.205: 	}
//│ ║         	^
//│ ╟── Originally declared here:
//│ ║  l.161: 	class A { class X { fun f = 1 } }
//│ ╙──       	          ^^^^^^^^^^^^^^^^^^^^^
//│ class C extends A {
//│   constructor()
//│   class X {
//│     constructor()
//│     fun g: 1
//│   }
//│ }



:e
class Foo2 extends Foo2
//│ ╔══[ERROR] Unhandled cyclic definition
//│ ║  l.227: 	class Foo2 extends Foo2
//│ ╙──       	^^^^^^^^^^^^^^^^^^^^^^^
//│ class Foo2 extends Foo2 {
//│   constructor()
//│ }
//│ Runtime error:
//│   RangeError: Maximum call stack size exceeded



