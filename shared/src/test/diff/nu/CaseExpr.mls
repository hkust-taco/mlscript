:NewDefs


case 0 then true
//│ 0 -> true
//│ res
//│     = [Function: res]

:pe // TODO support
case 0 then true, 1 then false
//│ ╔══[PARSE ERROR] Expected end of input; found comma instead
//│ ║  l.10: 	case 0 then true, 1 then false
//│ ╙──      	                ^
//│ 0 -> true
//│ res
//│     = [Function: res]

case
  0 then true
  1 then false
//│ (0 | 1) -> Bool
//│ res
//│     = [Function: res]


fun foo = case
  0 then true
  1 then false
//│ fun foo: (0 | 1) -> Bool

[foo(0), foo(1)]
//│ [Bool, Bool]
//│ res
//│     = [ true, false ]



abstract class Option[out A]
class Some[out A](val value: A) extends Option[A]
module None extends Option[nothing]
//│ abstract class Option[A]
//│ class Some[A](value: A) extends Option
//│ module None extends Option


fun map(f) = case
  Some(x) then Some(f(x))
  None    then None
//│ fun map: forall 'A 'a. ((??A & 'A) -> 'a) -> (None | Some['A]) -> (None | Some['a])

map(succ) of Some of 123
//│ None | Some[Int]
//│ res
//│     = Some {}

map(succ) of None
//│ None | Some[Int]
//│ res
//│     = None { class: [class None extends Option] }


:pe // TODO support
:e
:w
fun map(f) = case
  Some(x)   then Some(f(x))
  None as n then n
//│ ╔══[PARSE ERROR] Unexpected 'as' keyword in expression position
//│ ║  l.67: 	  None as n then n
//│ ╙──      	       ^^
//│ ╔══[WARNING] Paren-less applications should use the 'of' keyword
//│ ║  l.67: 	  None as n then n
//│ ╙──      	  ^^^^^^^^^
//│ ╔══[ERROR] module None expects 0 parameter but found 1 parameter
//│ ║  l.67: 	  None as n then n
//│ ╙──      	  ^^^^^^^^^
//│ fun map: anything -> anything -> error
//│ Code generation encountered an error:
//│   if expression was not desugared


:pe
case 1
//│ ╔══[PARSE ERROR] Expected 'then'/'else' clause after 'case'; found integer literal instead
//│ ║  l.83: 	case 1
//│ ║        	     ^
//│ ╟── Note: 'case' expression starts here:
//│ ║  l.83: 	case 1
//│ ╙──      	^^^^
//│ anything -> 1
//│ res
//│     = [Function: res]

:pe
case (1 then true)
//│ ╔══[PARSE ERROR] Unexpected 'then' keyword here
//│ ║  l.95: 	case (1 then true)
//│ ╙──      	        ^^^^
//│ ╔══[PARSE ERROR] Expected 'then'/'else' clause after 'case'; found integer literal instead
//│ ║  l.95: 	case (1 then true)
//│ ║        	     ^^^^^^^^^^^^^
//│ ╟── Note: 'case' expression starts here:
//│ ║  l.95: 	case (1 then true)
//│ ╙──      	^^^^
//│ anything -> 1
//│ res
//│     = [Function: res]

case else 0
//│ anything -> 0
//│ res
//│     = [Function: res]

:pe
case then 1 else 0
//│ ╔══[PARSE ERROR] Unexpected 'then' keyword in expression position
//│ ║  l.115: 	case then 1 else 0
//│ ╙──       	     ^^^^
//│ ╔══[PARSE ERROR] Expected 'then'/'else' clause after 'case'; found integer literal instead
//│ ║  l.115: 	case then 1 else 0
//│ ║         	          ^
//│ ╟── Note: 'case' expression starts here:
//│ ║  l.115: 	case then 1 else 0
//│ ╙──       	^^^^
//│ ╔══[PARSE ERROR] Expected end of input; found 'else' keyword instead
//│ ║  l.115: 	case then 1 else 0
//│ ╙──       	            ^^^^
//│ anything -> 1
//│ res
//│     = [Function: res]



// TODO:

:pe
:e
case x, y then x + y
//│ ╔══[PARSE ERROR] Expected 'then'/'else' clause after 'case'; found reference instead
//│ ║  l.138: 	case x, y then x + y
//│ ║         	     ^
//│ ╟── Note: 'case' expression starts here:
//│ ║  l.138: 	case x, y then x + y
//│ ╙──       	^^^^
//│ ╔══[PARSE ERROR] Expected end of input; found comma instead
//│ ║  l.138: 	case x, y then x + y
//│ ╙──       	      ^
//│ ╔══[ERROR] identifier not found: x
//│ ║  l.138: 	case x, y then x + y
//│ ╙──       	     ^
//│ anything -> error
//│ Code generation encountered an error:
//│   unresolved symbol x

:pe
:e
case (x, y) then x + y
//│ ╔══[PARSE ERROR] Expected '=>' or '->' after this parameter section
//│ ║  l.157: 	case (x, y) then x + y
//│ ╙──       	     ^^^^^^
//│ ╔══[ERROR] type identifier not found: Tuple#2
//│ ╙──
//│ nothing -> error
//│ Code generation encountered an error:
//│   unknown match case: Tuple#2

:e // * FIXME[UCS]
case [x, y] then x + y
//│ ╔══[ERROR] type identifier not found: Tuple#2
//│ ╙──
//│ nothing -> error
//│ Code generation encountered an error:
//│   unknown match case: Tuple#2



