:NewDefs

// This should not be needed once we implemented the @tailrec annotation internally.
module tailrec extends Annotation
//│ module tailrec extends Annotation

tailrec
//│ tailrec
//│ res
//│     = tailrec { class: [class tailrec extends Object] }

@tailrec fun foo(n) =
  if n > 0 then
    log(join of "hi ", String(n))
    foo(n - 1)
  else ()
//│ fun foo: Int -> ()


module Foo extends Annotation { 
}
//│ module Foo extends Annotation

@Foo 5
//│ 5
//│ res
//│     = 5

Foo
//│ Foo
//│ res
//│     = Foo { class: [class Foo extends Object] }

:e
@Bar 5
//│ ╔══[ERROR] identifier not found: Bar
//│ ║  l.35: 	@Bar 5
//│ ╙──      	 ^^^
//│ 5
//│ res
//│     = 5

fun foo(n) =
  if n > 0 then
    log(join of "hi ", String(n))
    foo(div of n,  2)
    @tailrec foo(n - 1)
  else ()
//│ fun foo: Int -> ()

:NoJS // recurses infinitely since `div` is float division. do not run it for now
foo(5)
//│ ()



// TODO: Tail recursion modulo cons
// fun foo(n) =
//   ...
//   Cons(a, foo(n - 1))
// ———>
// fun foo(n) =
//   ...
//   foo(n - 1, Cons(a, .))


